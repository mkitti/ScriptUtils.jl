<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · ScriptUtils.jl</title><script data-outdated-warner src="assets/warner.js"></script><link rel="canonical" href="https://mkitti.github.io/ScriptUtils.jl/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>ScriptUtils.jl</a></span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/mkitti/ScriptUtils.jl/blob/main/docs/src/index.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="ScriptUtils"><a class="docs-heading-anchor" href="#ScriptUtils">ScriptUtils</a><a id="ScriptUtils-1"></a><a class="docs-heading-anchor-permalink" href="#ScriptUtils" title="Permalink"></a></h1><p>Documentation for <a href="https://github.com/mkitti/ScriptUtils.jl">ScriptUtils</a>.</p><ul><li><a href="#ScriptUtils.ScriptUtils"><code>ScriptUtils.ScriptUtils</code></a></li><li><a href="#ScriptUtils.activate_dir"><code>ScriptUtils.activate_dir</code></a></li><li><a href="#ScriptUtils.ismain-Tuple{Any}"><code>ScriptUtils.ismain</code></a></li><li><a href="#ScriptUtils.resolve_links-Tuple{Any}"><code>ScriptUtils.resolve_links</code></a></li><li><a href="#ScriptUtils.@activate_and_use"><code>ScriptUtils.@activate_and_use</code></a></li><li><a href="#ScriptUtils.@activate_dir"><code>ScriptUtils.@activate_dir</code></a></li><li><a href="#ScriptUtils.@default_init"><code>ScriptUtils.@default_init</code></a></li><li><a href="#ScriptUtils.@script"><code>ScriptUtils.@script</code></a></li></ul><article class="docstring"><header><a class="docstring-binding" id="ScriptUtils.ScriptUtils" href="#ScriptUtils.ScriptUtils"><code>ScriptUtils.ScriptUtils</code></a> — <span class="docstring-category">Module</span></header><section><div><pre><code class="language-julia hljs">ScriptUtils</code></pre><p>Utility package for building scripts that loads a precompiled package.</p><p>The main concept is to enable small scripts that:</p><ol><li>Activate the package environment in which they are contained.</li><li>Load the package</li><li>Execute a main function on <code>__init__</code></li></ol><p>Importantly, the main function will not be executed on module initialization when loaded as a library from another package.</p><p><strong>Installation</strong></p><p>To use this package, add ScriptUtils both to your default environment (e.g. v.1.9), and your project package environment (e.g. Echo.jl as below).</p><pre><code class="nohighlight hljs">using Pkg
Pkg.activate(&quot;/path/to/your/package&quot;)
Pkg.add(&quot;https://github.com/mkitti/ScriptUtils.jl&quot;)
Pkg.activate() # activate the default module
Pkg.add(&quot;https://github.com/mkitti/ScriptUtils.jl&quot;)</code></pre><p><strong>Example</strong></p><p>For example, we will create an Echo.jl package that can be run with an echo.jl script.</p><p>The Echo.jl package has the following layout.</p><pre><code class="nohighlight hljs">[drwxrwxr-x]  Echo.jl
├── [-rw-rw-r--]  Manifest.toml
├── [-rw-rw-r--]  Project.toml
├── [drwxrwxr-x]  scripts
│   └── [-rwxrwxr-x]  echo.jl
└── [drwxrwxr-x]  src
    ├── [-rw-rw-r--]  Echo.jl

2 directories, 4 files</code></pre><p>Echo.jl/scripts/echo.jl has the following contents.</p><pre><code class="nohighlight hljs">#!/bin/env julia
using ScriptUtils
@activate_dir &quot;..&quot;
using Echo</code></pre><p>The <code>@activate_dir</code> macro finds the package environment, Echo.jl in this example, and then activates the environment via <code>Pkg</code>.</p><p>Echo.jl/src/Echo.jl is a main package file and appears as follows.</p><pre><code class="nohighlight hljs">module Echo
    using ScriptUtils
    @default_init()
    main(args=ARGS) = echo(args)
    echo(args) = println(join(args, &quot; &quot;))
end</code></pre><p>The minimalist Project.toml declares ScriptUtils as a dependency.</p><pre><code class="nohighlight hljs">name = &quot;Echo&quot;
uuid = &quot;594283f3-b8da-40eb-8bd5-2e27980f0e39&quot;

[deps]
ScriptUtils = &quot;f569facd-b734-495c-9df5-0762dee8e069&quot;</code></pre><p>The script file can then be symlinked into the user&#39;s path (e.g. ~/bin) and invoked as an executable script from any location.</p><pre><code class="nohighlight hljs">$ ln -s ~/src/Echo.jl/scripts/echo.jl ~/bin/

$ echo.jl This is a test
  Activating project at `~/src/Echo.jl`
This is a test

# The package can still be loaded as a library and main will not run.
$ julia --project=Echo.jl -e &#39;using Echo; Echo.echo([&quot;Hello&quot;])&#39;
Hello</code></pre><p><strong>Extended Help</strong></p><p><strong><code>@default_init</code> macro</strong></p><p>The <code>@default_init()</code> macro declares the function <code>__init__</code> such that if the <code>PROGRAM_FILE</code> is echo.jl, the lower case version of file name, then <code>main(ARGS)</code> is run.</p><p>Echo.jl/src/Echo.jl can be expanded out if you would prefer to define your own <code>__init__</code>:</p><pre><code class="nohighlight hljs">module Echo
    using ScriptUtils
    __init__() = ismain(@script) ? main(ARGS) : nothing
    main(args=ARGS) = echo(args)
    echo(args) = println(join(args, &quot; &quot;))
end</code></pre><p><strong><code>@script</code> macro</strong></p><p>Above, the <code>@script</code> macro locates a script file located in the <code>scripts</code> directory. The default is the lowercase version of the calling file. The name of the file can also be specified as an argument as below.</p><pre><code class="nohighlight hljs">julia&gt; @script(&quot;somefilename&quot;)
&quot;~/src/Echo.jl/scripts/somefilename&quot;</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mkitti/ScriptUtils.jl/blob/c73acb48bd79e81361c560a0c583c1c56cad1f84/src/ScriptUtils.jl#L1-L119">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ScriptUtils.activate_dir" href="#ScriptUtils.activate_dir"><code>ScriptUtils.activate_dir</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">activate_dir(relative_dir, script_file, always_quiet=false, popq=true)</code></pre><p>Supports the <a href="#ScriptUtils.@activate_dir"><code>@activate_dir</code></a> macro.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mkitti/ScriptUtils.jl/blob/c73acb48bd79e81361c560a0c583c1c56cad1f84/src/ScriptUtils.jl#L148-L152">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ScriptUtils.ismain-Tuple{Any}" href="#ScriptUtils.ismain-Tuple{Any}"><code>ScriptUtils.ismain</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">ismain(executable)</code></pre><p>Return true if the file specified by <code>executable</code> is equal to <code>PROGRAM_FILE</code>, resolving absolute paths and symbolic links.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mkitti/ScriptUtils.jl/blob/c73acb48bd79e81361c560a0c583c1c56cad1f84/src/ScriptUtils.jl#L214-L219">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ScriptUtils.resolve_links-Tuple{Any}" href="#ScriptUtils.resolve_links-Tuple{Any}"><code>ScriptUtils.resolve_links</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">resolve_links(path)</code></pre><p>Recursively resolve symbol links.</p><p>See also <code>islink</code> and <code>readlink</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mkitti/ScriptUtils.jl/blob/c73acb48bd79e81361c560a0c583c1c56cad1f84/src/ScriptUtils.jl#L255-L261">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ScriptUtils.@activate_and_use" href="#ScriptUtils.@activate_and_use"><code>ScriptUtils.@activate_and_use</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@activate_and_use(relative_dir=&quot;..&quot;, always_quiet=false, popq=true)</code></pre><p>Activate a project environment directory relative to the current file and use the associated package.</p><p>See <a href="#ScriptUtils.@activate_dir"><code>@activate_dir</code></a> for details on the arguments.</p><p>In addition to activating the environment, this macro will import the package using <code>Base.require</code>. If importing fails, then the macro will use <code>Pkg.instantiate()</code> before trying to import the package again.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mkitti/ScriptUtils.jl/blob/c73acb48bd79e81361c560a0c583c1c56cad1f84/src/ScriptUtils.jl#L170-L181">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ScriptUtils.@activate_dir" href="#ScriptUtils.@activate_dir"><code>ScriptUtils.@activate_dir</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@activate_dir(relative_directory=&quot;..&quot;, always_quiet=false, popq=true))</code></pre><p>Activate a project environment directory relative to the current file.</p><p>The default is to activate the parent directory of the directory where the file is located. If the script is located in the same folder as Project.toml, then specify <code>&quot;.&quot;</code> as the first argument.</p><p><code>Pkg.activate</code> will print some text default to <code>stderr</code> by default about activating an environment. To suppress this output add a <code>-q</code> as the first argument. This <code>-q</code> will be removed from <code>ARGS</code> unless <code>popq</code> is <code>false</code>.</p><p>The <code>always_quiet</code> positional argument will be always suppress <code>Pkg.activate</code> is set to true. The <code>-q</code> argument will not be used.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mkitti/ScriptUtils.jl/blob/c73acb48bd79e81361c560a0c583c1c56cad1f84/src/ScriptUtils.jl#L127-L142">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ScriptUtils.@default_init" href="#ScriptUtils.@default_init"><code>ScriptUtils.@default_init</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@default_init(script_file_absolute_path = nothing)</code></pre><p>Define a <code>__init__</code> function that will call <code>main(ARGS)</code> if a script file with the given absolute path is the <code>PROGRAM_FILE</code>.</p><p>The default script file is lowercased name of the module with &quot;.jl&quot; appended in the scripts subfolder of the grandparent directory</p><p>For example, if called from the file &quot;Echo.jl/src/Echo.jl&quot; then default script file will be &quot;Echo.jl/script/echo.jl&quot;.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mkitti/ScriptUtils.jl/blob/c73acb48bd79e81361c560a0c583c1c56cad1f84/src/ScriptUtils.jl#L229-L240">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ScriptUtils.@script" href="#ScriptUtils.@script"><code>ScriptUtils.@script</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@script(filename)</code></pre><p>Return the absolute path of a script file defaulting to scripts subdirectory of the package.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mkitti/ScriptUtils.jl/blob/c73acb48bd79e81361c560a0c583c1c56cad1f84/src/ScriptUtils.jl#L197-L202">source</a></section></article></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Wednesday 5 July 2023 02:28">Wednesday 5 July 2023</span>. Using Julia version 1.9.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
